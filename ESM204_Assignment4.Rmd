---
title: "ESM204_Assignment4"
author: "Alex Brown"
date: "5/29/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(stargazer)
library(wesanderson)

```

```{r}
mc_abatement <- read_csv("HW4Data.csv")
```

##1. Write down a plausible function form for the marginal cost of abatement for sectors: A, B, C, D. How well do your models fit the data for each sector? You may need to experiment with different functional forms. Produce a plot of the estimated marginal abatement cost functions in all four sectors (this plot should go in your memo).

```{r}
MC_A_model <- lm(MC_A ~ Abatement, data = mc_abatement)

summary(MC_A_model)

A_int <- MC_A_model$coefficients[1] 
#A_int <- -8.64
A_slope <- MC_A_model$coefficients[2]
#A_slope <- 0.577

MC_B_model <- lm(MC_B ~ Abatement, data = mc_abatement)

summary(MC_B_model)

B_int <- MC_B_model$coefficients[1]
#B_int <- 9.32
B_slope <- MC_B_model$coefficients[2]
#B_slope <- 0.199

MC_C_model <- lm(MC_C ~ Abatement, data = mc_abatement)

summary(MC_C_model)

C_int <- MC_C_model$coefficients[1]
#C_int <- -11.7
C_slope <- MC_C_model$coefficients[2]
#C_slope <- 0.784

MC_D_model <- lm(MC_D ~ Abatement, data = mc_abatement)

summary(MC_D_model)

D_int <- MC_D_model$coefficients[1]
#D_int <- 9.69
D_slope <- MC_D_model$coefficients[2]
#D_slope <- 0.26

#prod_vis <- ggplot(production_frame, aes(x = year,y = metric_ton, color = prod_by_sector)) +
 # geom_line() +

model_plot <- ggplot(mc_abatement, aes(x = Abatement))+
  geom_point(aes(y = MC_A, color = "MC_A"))+
  geom_smooth(aes(y = MC_A), method = lm, se = FALSE, size = 0.5, color = "red")+
  geom_point(aes(y = MC_B, color = "MC_B"))+
  geom_smooth(aes(y = MC_B), method = lm, se = FALSE, size = 0.5, color = "darkseagreen3")+
  geom_point(aes(y = MC_C, color = "MC_C"))+
  geom_smooth(aes(y = MC_C), method = lm, se = FALSE, size = 0.5, color = "orange")+
  geom_point(aes(y = MC_D, color = "MC_D"))+
  geom_smooth(aes(y = MC_D), method = lm, se = FALSE, size = 0.5, color = "darksalmon")+
  scale_color_manual(values  = wes_palette("Darjeeling1"), name = "Sector", labels = c("A", "B", "C", "D")) +
  scale_y_continuous(expand = c(0,5)) + # can change back to 0,0 
  scale_x_continuous(expand = c(0,5)) + # can change back to 0,0
  theme_classic() +
  labs(x = "Abatement (tons of CO2)",
       y = "Marginal Cost of Abatement ($/ton)", 
       title = "Marginal Cost") +
  theme(plot.title = element_text(hjust = 0.5))
  

#geom_line(data = catch_df, aes(x = catch_time_seq, y = catch_modeling), color = "red", size = 1)

model_plot
```

<<<<<<< HEAD
##2. Using these models and the current level of carbon emissions, derive each sector's demand curve for carbon emissions. In other words, how much would each sector be willing to pay for the right to pollute the first unit, second unit, etc? Draw these demand curves on a graph. Which sector is willing to pay the most for the first unit of carbon emissions?

```{r}


```

##3. For country X (Sectors A, B, and C), assume there are no "co-benefits" (i.e. that there are no local pollutants that are affected by carbon abatement). Suppose to meet the Paris Accord commitments, country X needs to cut all carbon emissions in half. For each of the policy options listed below, derive: (1) the total cost of meeting the target in country X, (2) the cost (or benefit) to each sector, and (3) the tax revenue generated.

###a. Cap on carbon. Each sector (A, B, and C) must cut its carbon emissions by 100 tons (thus reducing total emissions from 600 down to 300).

```{r}

```

###b. Tax on carbon. To emit a ton of carbon in country X, you must pay a tax of $t. You will need to find the tax that accomplishes the desired reduction.

```{r}

```

###c. Cap and trade. Each sector (A, B, C) is allocated carbon permits equal to their current emissions minus 100 (same as in (a) above), thus achieving the total reduction of 300. Then, these three sectors are allowed to trade with each other. You will need to derive the outcome of that trading.

```{r}

```

##4. Again, without any co-benefits, suppose that country Y (which only has one carbon-emitting sector, D) has no obligation to reduce its emissions. Country X asks country Y to enter the country X carbon market. Doing so would require country Y to put a cap on carbon emissions at its current level of emissions (300 tons), but would then allow country Y to sell carbon offsets to sectors A, B, or C. Are there any incentives for country Y to enter country Xâ€™s carbon market and to thus place a voluntary cap on its emissions? Are there any incentives for country X to try to attract country Y into its market?

```{r}

```

##5. Now assume that every ton of carbon emissions creates 1 ton of local air pollution. Local air pollution causes economic damages (health, environmental, etc.), but only in the country in which it is emitted. Assume there are no local air pollution regulations in either country X or country Y.

###a. In a carbon cap and trade market that only covers sectors in country X, how much local air pollution would you expect in country X? In country Y?

```{r}

```

###b. If country Y enters the carbon market for country X (as in question 4 above), how much local pollution will there be in country X and country Y?

```{r}

```

###c. What advice can you give country X and country Y about the desirability of allowing international trade of carbon emissions credits?

```{r}

```

=======
##2 
```{r}

sectorAmp = MC_A_model$coefficients[2]*180 + MC_A_model$coefficients[1]
#WTP for first unit is $95.19
sectorBmp = MC_B_model$coefficients[2]*200 + MC_B_model$coefficients[1]
#WTP for first unit is $49.07
sectorCmp = MC_C_model$coefficients[2]*220 + MC_C_model$coefficients[1]
#WTP for first unit is $160.79
sectorDmp = MC_D_model$coefficients[2]*300 + MC_D_model$coefficients[1]
#WTP for first unit is $87.67

#sector C willing to pay the most for the first unit of carbon emissions

# demand function for sector A
q_A <- seq(0,180,by=10)
d_A <- function(q){(A_slope*(180-q)) + A_int}
demand_A <- d_A(q_A)
curve(d_A, from=0, to=300, xlab = "quantity", ylab = "price",  ylim = c(0,200), xlim = c(0,350), col = "red")

# demand function for sector B
q_B <- seq(0,200,by=10)
d_B <- function(q){(B_slope*(200-q) + B_int)}
demand_B <- d_B(q_B)
curve(d_B, from=0, to=300, xlab= "quantity", ylab = "price", add= TRUE,  ylim = c(0,200), xlim = c(0,350), col = "green")

# demand function for sector C
q_C <- seq(0,220,by=10)
d_C <- function(q){(C_slope*(220-q) + C_int)}
demand_C <- d_C(q_C)
curve(d_C, from=0, to=300, xlab= "quantity", ylab = "price", add= TRUE,  ylim = c(0,200), xlim = c(0,350), col = "yellow")

# demand function for sector D
q_D <- seq(0,300,by=10)
d_D <- function(q){(D_slope*(300-q) + D_int)}
demand_D <- d_D(q_D)
curve(d_D, from=0, to=400, xlab= "quantity", ylab = "price", add= TRUE, ylim = c(0,200), xlim = c(0,350), col = "orange")

```

## another demand graph for #2
```{r}

demand_plot <-ggplot(data.frame(x=c(0,200)))+
  stat_function(fun=d_A, aes(color = "A"))+
  stat_function(fun=d_B, aes(color = "B"))+
  stat_function(fun=d_C, aes(color = "C"))+
  stat_function(fun=d_D, aes(color = "D"))+
  scale_x_continuous(limits = c(0,400), expand = c(0,0))+
  scale_y_continuous(limits = c(0,200), expand = c(0,0))+
  labs(fil = "", 
       color = "Sector", 
       x = "Carbon Demanded (tons of CO2)",
       y = "Price ($/ton)",
       title = "Carbon Emission Demand by Sector")+
  theme_classic() +
  scale_color_manual(values  = wes_palette("Darjeeling1"), name = "Sector", labels = c("A", "B", "C", "D")) +
  theme(plot.title = element_text(hjust = 0.5))
demand_plot
```

##3  just messing around - Alex Ivina

#### a
```{r}

## Find supply curves first

s_A = function(x){
  (MC_A_model$coefficients[2]*x +MC_A_model$coefficients[1])
  }
s_B = function(x){
  (MC_B_model$coefficients[2]*x +MC_B_model$coefficients[1])
}
s_C = function(x){
  (MC_C_model$coefficients[2]*x +MC_C_model$coefficients[1])
}

```

```{r}

# Each sector cuts their emission by 100; total 300
# sector A: 180 to 80
# sector B: 200 to 100
# sector C: 220 to 120

Sector_A <- integrate(s_A, 0, 100)
Sector_B <- integrate(s_B, 0, 100)
Sector_C <- integrate(s_C, 0, 100)
Sector_A$value # 2019.762
Sector_B$value # 1925.491
Sector_C$value # 2753.63
TC_country_cap <- Sector_A$value + Sector_B$value + Sector_C$value
TC_country_cap # 6698.883
# no tax revenue generated

```

###b Tax on carbon 

```{r}

# first rearrange supply curves
A_rearrange <- function(y){(1/a$coefficients[2])*(-a$coefficients[1] + y)}
B_rearrange <- function(y){(1/b$coefficients[2])*(-b$coefficients[1] + y)}
C_rearrange <- function(y){(1/c$coefficients[2])*(-c$coefficients[1] + y)}
#ag_supply_country_X2 <- function(y){A_rearrange(y) + B_rearrange(y) + C_rearrange(y)}
ag_intercept <- (-a$coefficients[1]/a$coefficients[2]) + (-b$coefficients[1]/b$coefficients[2]) + (-c$coefficients[1]/c$coefficients[2])
ag_slope <- (1/a$coefficients[2]) + (1/b$coefficients[2]) + (1/c$coefficients[2])
ag_supply_country_X <- function(x){(-ag_intercept/ag_slope) + (x/ag_slope)}
taxprice <- ag_supply_country_X(300)
A_rearrange(taxprice) + B_rearrange(taxprice) + C_rearrange(taxprice)
A_abate <- A_rearrange(taxprice) # 83.33489 
B_abate <- B_rearrange(taxprice) # 151.4956
C_abate <- C_rearrange(taxprice) # 65.16953 
A_tax_abatementcost <- integrate(supply_A, lower = 0, upper = A_abate) 
TC_A_tax <- A_tax_abatementcost$value + (cp_A - A_abate)*taxprice   
#  5093.786 
B_tax_abatementcost <- integrate(supply_B, lower = 0, upper = B_abate) 
TC_B_tax <- B_tax_abatementcost$value + (cp_B - B_abate)*taxprice   
#  5604.635 
C_tax_abatementcost <- integrate(supply_C, lower = 0, upper = C_abate) 
TC_C_tax <- C_tax_abatementcost$value + (cp_C - C_abate)*taxprice   
#  7009.365  
TC_country_tax <- TC_C_tax + TC_B_tax + TC_A_tax
#  17707.79
#tax revenue generated
tax_rev <- (cp_A - A_abate)*taxprice + (cp_B - B_abate)*taxprice  + (cp_C - C_abate)*taxprice 
#  11827.97 


```


## 3

##a 
```{r, include=FALSE}
abate<-c(100, 100, 100, 300) # 100 for each sector, adds up to total for country
MCa<-(-0.58*100) + 95.75  # slope * abatement + WTP (1st unit)
MCb<-(-0.2*100) + 49.32 # slope * abatement + WTP (1st unit)
MCc<-(-0.78*100) + 159.94 # slope * abatement + WTP (1st unit)
MC<-rbind(MCa, MCb, MCc, NA)
costa<-(MCa*100)+(100*(95.97-MCa)*0.5) # calculates area under the demand curve up to 100 tons of emissions for A
costb<-(MCb*100)+(100*(49.32-MCb)*0.5) # calculates area under the demand curve up to 100 tons of emissions for A
costc<-(MCc*100)+(100*(159.94-MCc)*0.5)# calculates area under the demand curve up to 100 tons of emissions for A
totalcost<-sum(costa, costb, costc) #adds up areas
cost<-rbind(costa, costb, costc, totalcost)
parta<- cbind(abate, MC, cost)
colnames(parta)=c("Units abated","Marginal cost", "Cost")
row.names(parta)=c("Sector A", "Sector B", "Sector C", "Total Country X")
parta

# calculates area under the demand curve up to 100 tons of emissions for A,B,C. Gives you the forgone benefits using WTP functions for each sector
```

```{r, echo=FALSE}
round(parta, 0)
```

             Units abated Marginal cost  Cost
Sector A                 100            38  6686
Sector B                 100            29  3932
Sector C                 100            82 12094
Total Country X          300            NA 22712

##b


```{r, include=FALSE}
MC<-(616.74-300) /8 
a<-( 95.75 - 0)/0.58 # Sector A WTP (1st unit) divided by slope
b<-(49.32-0)/ 0.2 # Sector B WTP (1st unit) divided by slope
c<-(159.94-0)/0.78 # Sector C WTP (1st unit) divided by slope
abatea<-(95.75 - MC)/0.58 # sector A abatement
abateb<-(49.32-MC)/ 0.2 # sector B abatement
abatec<-(159.94-MC)/0.78 # sector C abatement
totalabate<-sum(abatea, abateb, abatec) # aggregate abatement
abate<-rbind(abatea, abateb, abatec, totalabate)
taxa<-abatea*MC # sector A abatement * marginal cost
taxb<-abateb*MC # sector B abatement * marginal cost
taxc<-abatec*MC # sector C abatement * marginal cost
totaltax<-sum(taxa, taxb, taxc)
tax<-rbind(taxa, taxb, taxc, totaltax)
costa<-MC*(a-abatea)*0.5 # Area of Sector A MC * (Sector A WTP (1st unit) divided by slope - sector A Abatement)
costb<-MC*(b-abateb)*0.5 # Area of Sector B MC * (Sector B WTP (1st unit) divided by slope - sector B Abatement)
costc<-MC*(c-abatec)*0.5 # Area of Sector C MC * (Sector C WTP (1st unit) divided by slope - sector C Abatement)
totalcost<-sum(costa, costb, costc)
cost<-rbind(costa, costb, costc, totalcost)
  
partb<- cbind(abate, cost,tax)
colnames(partb)=c("Units abated", "Cost","Tax")
row.names(partb)=c("Sector A", "Sector B", "Sector C", "Total Country X")
partb

# marginal abatement costs are equal
```

```{r, echo=FALSE}
round(partb,0)
```
Units abated Cost   Tax
Sector A                  97 1351  3833
Sector B                  49 3919  1926
Sector C                 154 1005  6109
Total Country X          300 6275 11868

## c

```{r, include=FALSE}
MC<-(616.74-300) /8
abatea<-( 95.75 - MC)/0.58 # sector A abatement
abateb<-(49.32-MC)/ 0.2 # sector B abatement
abatec<-(159.94-MC)/0.78 # sector C abatement 
totalabate<-sum(abatea, abateb, abatec)
abate<-rbind(abatea, abateb, abatec, totalabate)
costa<-(abatea*MC)+(abatea*(95.97-MC)*0.5) # Area of Sector A MC * (Sector A WTP (1st unit) divided by slope - sector A Abatement)
costb<-(abateb*MC)+(abateb*(49.32-MC)*0.5) # Area of Sector B MC * (Sector B WTP (1st unit) divided by slope - sector B Abatement)
costc<-(abatec*MC)+(abatec*(159.94-MC)*0.5) # Area of Sector C MC * (Sector C WTP (1st unit) divided by slope - sector C Abatement)
totalcost<-sum(costa, costb, costc)
cost<-rbind(costa, costb, costc, totalcost)
partc<- cbind(abate, cost)
colnames(partc)=c("Units abated", "Cost")
row.names(partc)=c("Sector A", "Sector B", "Sector C", "Total Country X")
partc

#equimarginal principle

# aggregate goods horizontally 

# abate 300 units of emissions the cost of abatement that meets the equimarginal principle is $39.59.
```

```{r, echo=FALSE}
round(partc,0)
```

Units abated  Cost
Sector A                  97  6563
Sector B                  49  2162
Sector C                 154 15393
Total Country X          300 24118


#5

###a



###b 


```{r, include=FALSE}
MC<-(954.01-600) /11.85
MC
300-222
(87.69 - 39.59)/0.26
abatea<-(95.75 - MC)/0.58 
abateb<-(49.32-MC)/ 0.2
abatec<-(159.94-MC)/0.78
abated<-(87.69 - MC)/0.26
totalabate<-sum(abatea, abateb, abatec, abated)
abate<-rbind(abatea, abateb, abatec, abated, totalabate)
abate
costa<-(abatea*MC)+(abatea*(95.97-MC)*0.5)
costb<-(abateb*MC)+(abateb*(49.32-MC)*0.5)
costc<-(abatec*MC)+(abatec*(159.94-MC)*0.5)
costd<-(abated*MC)+(abated*(87.69-MC)*0.5)
totalcost<-sum(costa, costb, costc, costd)
cost<-rbind(costa, costb, costc, costd, totalcost)
part5<- cbind(abate, cost)
colnames(part5)=c("Units abated", "Cost")
row.names(part5)=c("Sector A", "Sector B", "Sector C", "Sector D","Total")

part5
```

```{r, echo=FALSE}
round(part5,0)
```



###c


## 3 (another way)

3. Country X Abatement

a. Cap on carbon

```{r, total cost of meeting target if each county reduces by 100 tons}
# Sector A
# Marginal cost of carbon abatement = 0.5768*(Abatement) - 8.6445
0.5768*(100) - 8.6445
# Marginal cost = $49.0355
# Cost (area under the curve) = $2019.55 - this may be incorrect (Jess)
# To find the area under the curve, the equation is 0.5*100(base)*marginal cost(height)
sectorA_totalcost <- 0.5*100*49.0355
# Total cost of abatement of 100 for Sector A is $2451.775
# Sector B
# Marginal cost of carbon abatement = 0.1987*(Abatement) + 9.3177
0.1987*(100) + 9.3177
# Marginal cost = $29.1877
# Cost = $1925.27 - this may be wrong (Jess)
sectorB_totalcost <- 0.5*100*29.1877
# Total cost of abatement of 100 for Sector B is $1459.385
# Sector C
# Marginal cost of carbon abatement = 0.7838*(Abatement) - 11.6550
0.7838*(100) - 11.6550
# Marginal cost = 66.725
# Cost = $2753.5 - this may be wrong (Jess)
sectorC_totalcost <- 0.5*100*66.725
# Total cost of abatement of 100 for Sector C is $3336.25
# Total cost for Country X
# $6698.32 - this may be wrong (Jess)
# Total cost for Country X is $ 7247.41
countryX_totalcost3A <- sectorA_totalcost+sectorB_totalcost+sectorC_totalcost
# No tax revenue generated in this scenario
```


b. Tax on Carbon

```{r, add equations horizontally}
# Rearrange equations
# Sector A: Cost of carbon abatement = 0.5768*(Abatement) - 8.6445
# Abatement = 1.733703*(cost) + 14.987
      # non-rounded numbers just in case:
      a1 <- 1/0.5768
      a2 <- 8.6445/0.5768
# Sector B: Cost of carbon abatement = 0.1987*(Abatement) + 9.3177
# Abatement = 5.032713*(cost) -  46.89331
      # non-rounded numbers
      b1 <- 1/0.1987
      b2 <- -9.3177/0.1987
# Sector C: Cost of carbon abatement = 0.7838*(Abatement) - 11.6550
# Abatement = 1.275836*(cost) + 14.86986
      #non-rounded numbers
      c1 <- 1/0.7838
      c2 <- 11.6550/0.7838
      
# Add them up for aggregate equation
      
# Abatement = (a1 + b1 + c1)*cost + (a2 + b2 + c2)
      m1 <- (a1 + b1 + c1) # 8.042251
      y <- (a2 + b2 + c2) # -17.03644
# Abatement = 8.042251*(cost) - 17.03644
      
```

```{r, find tax price}
# Rearrange aggregate equation to y = mx + b form
      m <- 1/m1 # 0.12343
      b <- -y/m1 # 2.11837
# Marginal cost of abatement = 0.12343*(Abatement) + 2.11837
      
      
# Plug in abatement amount
tax <- 0.12343*(300) + 2.11837
# Marginal cost of abating 300 tons = $39.14737
# Tax should be set at $39.15
```

```{r, find quantity each sector will abate at tax price}
# Sector A
# 39.14737 = 0.5768*(Abatement) - 8.6445
sectorA_abatement3B <- (tax + 8.6445) / 0.5768
# Abatement = 82.85692 tons
# Sector B
# 39.14737 = 0.1987*(Abatement) + 9.3177
sectorB_abatement3B <- (tax - 9.3177) / 0.1987
# Abatement = 150.1242 tons
# Sector C
# 39.14737 = 0.7838*(Abatement) - 11.6550
sectorC_abatement3B <- (tax + 11.6550) / 0.7838
# Abatement = 64.81548 tons
```


```{r, cost to each sector}
sectorA_totalcost3B <- (0.5*tax*(sectorA_abatement3B))
# Total cost to Sector A under cap and trade is $1621.82
sectorB_totalcost3B <- (0.5*tax*(sectorB_abatement3B))
# Total cost to Sector B under cap and trade is $2938.48
sectorC_totalcost3B <- (0.5*tax*(sectorC_abatement3B))
# Total cost to Sector C under cap and trade is $1268.68
```


```{r, total cost of meeting target under a tax}
countryX_totalcost3B <- 0.5*300*tax
# Total cost of meeting target under tax for Country X is $5872.11
```

```{r, tax revenue generated in Country X}
countryX_taxrev3B <- 300*tax
# Tax revenue generated under tax of $39.15 is $11,744.21
```

C. Cap and trade.


```{r, cap and trade amounts for each sector}
# Sector A
# 39.14737 = 0.5768*(Abatement) - 8.6445
sectorA_captrade3C <- 100 - ((tax + 8.6445) / 0.5768)
# Sector A needs to buy 17.143 credits to actually abate 100 tons
# Sector B
# 39.14737 = 0.1987*(Abatement) + 9.3177
sectorB_captrade3C <- 100 - ((tax - 9.3177) / 0.1987)
# Sector B abated more than 100 tons, so it can sell 50.124 credits
# Sector C
# 39.14737 = 0.7838*(Abatement) - 11.6550
sectorC_captrade3C <- 100 - ((tax + 11.6550) / 0.7838)
# Sector C needs to buy 35.185 credits to actually abate 100 tons
```

```{r, cost to each sector and country as a whole}
sectorA_totalcost3C <- (0.5*tax*(sectorA_captrade3C+sectorA_abatement3B))
# Total cost to Sector A under cap and trade is $1957.37
sectorB_totalcost3C <- (0.5*tax*(sectorB_abatement3B + sectorB_captrade3C))
# Total cost to Sector B under cap and trade is $1957.37
sectorC_totalcost3C <- (0.5*tax*(sectorC_captrade3C + sectorC_abatement3B))
# Total cost to Sector C under cap and trade is $1957.37
countryX_totalcost3C <- sectorA_totalcost3C + sectorB_totalcost3C + sectorC_totalcost3C
# Total cost to Country X under cap and trade is $5872.11
```

No tax revenue in a cap and trade system
